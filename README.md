# LocalPay
非接触式离线支持方案

![image](https://github.com/user-attachments/assets/af8edeff-6436-4e11-896f-2ccc2fd9a7ed)


## 概念简介

一、离线支付

1、概念：离线支付技术的出现主要是为了解决一些特定场景下网络覆盖不足或网络不稳定的情况，以及提供与现金类似的支付体验。

2、技术实现逻辑：

（1）付款码：再离线支付系统中，如支付宝的离线支付，付款码可以在用户设备上离线生成，并且是一次性的，每分钟更新一次以确保安全。

（2）安全芯片、NFC：数字人民币的双离线支付采用NFC技术实现，需要收付款设备均具备内置安全芯片的硬件钱包功能。NFC技术支持点对点通信，无需第三方设备中转传输信号，从而在没有网络的情况下也能处理。

（3）防篡改用户设备：离线支付解决方案需要加强用户设备的防篡改性，通常基于硬件和软件两个方面。硬件方面包括防篡改芯片和可靠执行环境( TEE)，软件方面则利用软件技术保护静态或正在处理的数据

（4）价值传输协议：在设备间传输支付指令通常使用某种形式的公钥加密，允许用户设备和钱包相互验证，交换密钥并发送可以在接收设备上验证的签名消息。

（5）在线和离线账本管理：完全离线时，可以通过在线分类帐提供离线支付所需的特性和功能，而对于分阶段离线和间歇性离线，则需要设置离线分类帐来记录和核对离线钱包中的价值。

（6）风险管理：离线支付需要考虑风险管理，包括交易的重复列支付支风险、垫付和追缴机制等。例如，在公交双离线支付场景中，如果乘客钱包余额不足，业务系统需要有垫付机制，并限制乘客最多可欠款的乘车次数。

（7）加密技术升级：离线支付解决方案必须包括允许在需要时随时更改加密密钥和算法的机制，以应对潜在的安全威胁。

（8）特殊情况下的双离线支付：在某些特殊情况下，付款方和收款方都可以离线，单通常至少有一方需要在交易后与支付系统的服务器进行同步，以确保交易的最终结算。

二、非接支付

1、概念：非接触支付（Contactless Payment）是一种支付技术，允许用户在不接触支付终端的情况下完成交易，这种支付方式通常使用近场通信（NFC）技术、射频技术（RFID）技术或二维码技术，实现与支付系统的无线通信。

2、技术实现逻辑

（1）近场通信（NFC）技术：非接触式支付使用NFC技术来实现设备间的无数据传输。NFC是一种短距离高频无线电通信技术，允许设备在几厘米距离内交换数据。

（2）安全芯片（Secure Element ，SE）：支付设备内置有安全芯片，用于安全地存储支付信息和执行交易，这些芯片通常具有高级别的安全特性，可以抵御各种安全威胁。

（3）支付令牌化（Tokenization）：为了保护用户的支付信息，非接触式支付系统使用令牌化技术。这意味着用户的敏感支付信息（如信用卡号）被一个唯一的令牌代替，该令牌在交易中使用，以减少数据泄露的风险。

（4）动态数据认证（Dynamic Data Authentication, DDA）：在某些非接触式支付卡中，每次交易都会生成一个新的加密数据集，增加了支付过程的安全性。

（5）快速响应（Quick Response, QR）码：虽然QR码不是基于NFC技术，但它们也被用于非接触式支付。商家的支付终端可以扫描用户手机上显示的QR码来快速完成支付。

（6）交易认证：在非接触式支付过程中，交易需要被认证。这通常涉及到使用密码、PIN码、生物识别（如指纹或面部识别）等方法来验证用户的身份。

（7）支付网络和处理：非接触式支付交易需要通过支付网络进行处理，这些网络连接着发卡机构、收单机构、支付处理器和商家。

（8）兼容性和标准化：非接触式支付技术遵循国际支付标准（如EMV标准），确保不同设备和系统之间的互操作性。

